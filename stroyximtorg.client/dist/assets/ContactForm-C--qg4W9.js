import{r as h,R as x,j as v}from"./index-BzM8WCou.js";var b=function(){return b=Object.assign||function(a){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(a[c]=n[c])}return a},b.apply(this,arguments)};function w(e,a){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,t=Object.getOwnPropertySymbols(e);i<t.length;i++)a.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(e,t[i])&&(n[t[i]]=e[t[i]]);return n}function y(e,a){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var t=n.call(e),i,c=[],o;try{for(;(a===void 0||a-- >0)&&!(i=t.next()).done;)c.push(i.value)}catch(f){o={error:f}}finally{try{i&&!i.done&&(n=t.return)&&n.call(t)}finally{if(o)throw o.error}}return c}function k(e,a,n,t,i){n===void 0&&(n=null),i===void 0&&(i=!0);var c=document.createElement("script");c.src=e,c.onload=a,c.onerror=n,c.type="text/javascript",c.crossOrigin="anonymous",typeof window<"u"&&window.addEventListener("error",function(s){s.filename.indexOf(e)===0&&t&&t({filename:s.filename,message:s.message,col:s.colno,line:s.lineno})});var o=function(){return document.body.appendChild(c)};i?o():window.addEventListener("load",o)}var j=/^(\S+)$/,N=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,R=/^[^\s\.]+\.\S{2,}$/;function I(e){if(typeof e!="string")return!1;var a=e.match(j);if(!a)return!1;var n=a[0];return n?!!(N.test(n)||R.test(n)):!1}var E=function(e){return e===void 0&&(e="smartcaptcha.yandexcloud.net"),"https://"+e+"/captcha.js?render=onload&onload=__onSmartCaptchaReady"},_=[],S=new Map;function T(e,a){var n=y(h.useState(),2),t=n[0],i=n[1];return h.useEffect(function(){if(!(t!==void 0||e!==void 0&&!I(e))){window.__onSmartCaptchaReady===void 0&&(window.__onSmartCaptchaReady=function(){_.forEach(function(f){return f()})}),window.smartCaptcha&&i(window.smartCaptcha);var c=_.push(function(){return i(window.smartCaptcha)}),o=function(){a==null||a({filename:E(e),message:"Unknown error on script loading",col:0,line:0})};return S.get(e)||(k(E(e),null,o,a),S.set(e,!0)),function(){_.splice(c,1)}}},[e,a,t]),t}function O(e){var a=h.useRef({}),n=e.widgetId,t=e.smartCaptcha,i=e.onChallengeHidden,c=e.onChallengeVisible,o=e.onSuccess,f=e.onNetworkError,s=e.onTokenExpired,m=e.onJavascriptError;a.current={onChallengeHidden:i,onChallengeVisible:c,onSuccess:o,onNetworkError:f,onTokenExpired:s,onJavascriptError:m},h.useEffect(function(){if(!(!t||typeof n!="number")){var u=[t.subscribe(n,"challenge-visible",function(){var r,l;(l=(r=a.current).onChallengeVisible)===null||l===void 0||l.call(r)}),t.subscribe(n,"challenge-hidden",function(){var r,l;(l=(r=a.current).onChallengeHidden)===null||l===void 0||l.call(r)}),t.subscribe(n,"network-error",function(){var r,l;(l=(r=a.current).onNetworkError)===null||l===void 0||l.call(r)}),t.subscribe(n,"success",function(r){var l,d;(d=(l=a.current).onSuccess)===null||d===void 0||d.call(l,r)}),t.subscribe(n,"token-expired",function(){var r,l;(l=(r=a.current).onTokenExpired)===null||l===void 0||l.call(r)}),t.subscribe(n,"javascript-error",function(r){var l,d;(d=(l=a.current).onJavascriptError)===null||d===void 0||d.call(l,r)})];return function(){return u.forEach(function(r){return r==null?void 0:r()})}}},[n,t])}var L=typeof window<"u"?h.useLayoutEffect:h.useEffect,H=function(e){var a=h.useRef(null),n=e.onChallengeHidden,t=e.onChallengeVisible,i=e.onSuccess,c=e.onNetworkError,o=e.onTokenExpired,f=e.onJavascriptError,s=e.language,m=e.host,u=w(e,["onChallengeHidden","onChallengeVisible","onSuccess","onNetworkError","onTokenExpired","onJavascriptError","language","host"]),r=T(m,f),l=y(h.useState(),2),d=l[0],p=l[1],C=h.useRef({});return O({widgetId:d,smartCaptcha:r,onChallengeHidden:n,onChallengeVisible:t,onSuccess:i,onNetworkError:c,onTokenExpired:o,onJavascriptError:f}),L(function(){if(!(!a.current||!r)){var g=r.render(a.current,b(b({},u),{invisible:!0,hl:s}));return p(g),function(){r==null||r.destroy(g),p(void 0),C.current[g]=!0}}},[r,s,u.hideShield,u.shieldPosition,u.sitekey,u.test,u.webview]),h.useEffect(function(){r&&u.visible&&typeof d=="number"&&!C.current[d]&&r.execute(d)},[r,u.visible,d]),x.createElement("div",{ref:a,className:"smart-captcha"})};const P=()=>{const[e,a]=h.useState(""),[n,t]=h.useState(null),i=h.useCallback(()=>{},[]),c=h.useCallback(o=>{a(o)},[]);return v.jsx("form",{children:v.jsx(H,{className:"InvisibleSmartCaptcha",sitekey:"<ключ_клиента>",onSuccess:c,onChallengeHidden:i,ref:o=>t(o?o.captcha:null)})})},V=()=>{const[e,a]=h.useState(!1),[n,t]=h.useState({tel:"",name:"",message:""});h.useEffect(()=>{document.cookie.split("; ").find(f=>f.startsWith("formSubmitted="))&&a(!0)},[]);const i=async o=>{if(o.preventDefault(),!e){if(!/^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/.test(n.tel)){alert("Пожалуйста, введите корректный номер телефона.");return}try{if((await fetch("https://localhost:7109/application",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok){a(!0);const s=new Date;s.setTime(s.getTime()+24*60*60*1e3),document.cookie=`formSubmitted=true; expires=${s.toUTCString()}; path=/`}else console.error("Ошибка при отправке формы")}catch(f){console.error("Ошибка сети:",f)}}},c=o=>{const{name:f,value:s}=o.target;t(m=>({...m,[f]:s}))};return h.useEffect(()=>{const o=document.querySelector("#tel"),f=(m,u)=>{if(u===document.activeElement){if(u.focus(),u.setSelectionRange)u.setSelectionRange(m,m);else if(u.createTextRange){const r=u.createTextRange();r.collapse(!0),r.moveEnd("character",m),r.moveStart("character",m),r.select()}}},s=m=>{let u="+7 (___) ___-__-__",r=0,l=u.replace(/\D/g,""),d=o.value.replace(/\D/g,"");l.length>=d.length&&(d=l),o.value=u.replace(/./g,function(p){return/[_\d]/.test(p)&&r<d.length?d.charAt(r++):r>=d.length?"":p}),m.type==="blur"&&o.value.length<18?o.value="":f(o.value.length,o),t(p=>({...p,tel:o.value}))};return o.addEventListener("input",s),o.addEventListener("focus",s),o.addEventListener("blur",s),()=>{o.removeEventListener("input",s),o.removeEventListener("focus",s),o.removeEventListener("blur",s)}},[]),v.jsxs("form",{id:"contact",action:"",method:"post",onSubmit:i,children:[v.jsxs("p",{className:"main__callback--wrapper--label",children:["Обратная ",v.jsx("br",{}),"связь"]}),v.jsx("fieldset",{children:v.jsx("input",{id:"tel",name:"tel",value:n.tel,onChange:c,className:"callback__input tel",placeholder:"Введите ваш номер для связи",type:"tel",tabIndex:"3",required:!0,title:"Введите номер телефона в формате +7 XXX XXX XX XX"})}),v.jsx("fieldset",{children:v.jsx("input",{name:"name",value:n.name,onChange:c,placeholder:"Введите ваше имя",type:"text",tabIndex:"1",required:!0,className:"callback__input"})}),v.jsx("fieldset",{children:v.jsx("textarea",{name:"message",value:n.message,onChange:c,placeholder:"Введите ваше сообщение:",tabIndex:"5",required:!0,maxLength:"256",className:"callback__input"})}),v.jsx("fieldset",{className:"Captcha__section",children:v.jsx(P,{})}),v.jsx("button",{type:"submit",className:"callback__submit",disabled:e,children:"Отправить"}),e&&v.jsxs("p",{className:"success-message",children:["Ваша заявка успешно отправлена!",v.jsx("span",{children:"Мы свяжемся с вами в ближайшее время."})]})]})};export{V as C};
